
# PRODUCT_PLAN — Ventprom Packer

## Цель
Веб-служба для упаковки воздуховодов в кузов (3D) с минимизацией количества машин, приоритизацией «большие снизу», визуализацией по рядам/слоям, импортом PDF/XLSX/TXT и экспортом PDF/GLB/самодостаточного HTML.

## Этапы и задачи
### Этап A — Каркас
- [ ] A1: Инициализация NestJS/Next.js (монорепо), общие скрипты.
- [ ] A2: Определить модели данных (`packages/core/src/models.ts`).
- [ ] A3: Заглушки REST и страниц, подключить ESLint/Prettier/Jest.

### Этап B — Парсинг файлов
- [ ] B1: XLSX парсер (`exceljs`), эвристики сопоставления колонок (RU/EN).
- [ ] B2: TXT/CSV парсер (регулярные выражения + конфиг).
- [ ] B3: PDF парсер (`pdf-parse`), извлечение таблиц и размеров.
- [ ] B4: Unit-тесты парсеров на `sample_files/*`.

### Этап C — Алгоритм упаковки
- [ ] C1: Базовый FFD (6 ориентаций), проверка коллизий, сетка 5 мм.
- [ ] C2: Слоистая укладка, правило «большие снизу» (baseArea/вес).
- [ ] C3: Мульти-старт + beam search (k=5), метрики и скоринг.
- [ ] C4: Unit-тесты на корректность и производительность.

### Этап D — 3D и UI
- [ ] D1: 3D сцена кузова (Three.js), пресеты + кастомные размеры.
- [ ] D2: Отрисовка воздуховодов, переключение рядов/слоёв.
- [ ] D3: Снимки рядов (canvas → base64) для PDF.
- [ ] D4: UX: загрузка файлов, таблица номенклатуры, фильтры.

### Этап E — Экспорт
- [ ] E1: Экспорт PDF (Puppeteer): титульная, спецификация, снимки.
- [ ] E2: Экспорт GLB и самодостаточного HTML-файла 3D сцены.

### Этап F — Автономия/CI
- [ ] F1: GitHub Actions: build, unit/e2e, публикация артефактов.
- [ ] F2: Docker Compose: web+api, инструкция деплоя.

## Критерии приёмки
- Все unit/e2e тесты зелёные.
- `docker compose up` поднимает web+api.
- Пресеты кузовов доступны, кастомные размеры работают.
- Экспорт PDF/GLB/HTML формируется и валидируется в тестах.
